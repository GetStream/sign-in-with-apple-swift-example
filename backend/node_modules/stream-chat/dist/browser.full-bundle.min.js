!function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=n(function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}e.exports=t});var s=function(e){if(Array.isArray(e))return e};var i=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){s=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(s)throw i}}return n}};var a=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var o=function(e,t){return s(e)||i(e,t)||a()};var c=function(e,t){if(null==e)return{};var n,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(s[n]=e[n]);return s};var u=function(e,t){if(null==e)return{};var n,r,s=c(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s},h=n(function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",o=s.toStringTag||"@@toStringTag";function c(e,t,n,r){var s=t&&t.prototype instanceof v?t:v,i=Object.create(s.prototype),a=new U(r||[]);return i._invoke=function(e,t,n){var r=h;return function(s,i){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===s)throw i;return O()}for(n.method=s,n.arg=i;;){var a=n.delegate;if(a){var o=C(a,n);if(o){if(o===d)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=u(e,t,n);if("normal"===c.type){if(r=n.done?p:l,c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",l="suspendedYield",f="executing",p="completed",d={};function v(){}function y(){}function g(){}var m={};m[i]=function(){return this};var w=Object.getPrototypeOf,b=w&&w(w(S([])));b&&b!==n&&r.call(b,i)&&(m=b);var _=g.prototype=v.prototype=Object.create(m);function k(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function x(e){var t;this._invoke=function(n,s){function i(){return new Promise(function(t,i){!function t(n,s,i,a){var o=u(e[n],e,s);if("throw"!==o.type){var c=o.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?Promise.resolve(h.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(h).then(function(e){c.value=e,i(c)},function(e){return t("throw",e,i,a)})}a(o.arg)}(n,s,t,i)})}return t=t?t.then(i,i):i()}}function C(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,C(e,n),"throw"===n.method))return d;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var s=u(r,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,d;var i=s.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function S(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function n(){for(;++s<e.length;)if(r.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=_.constructor=g,g.constructor=y,g[o]=y.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},k(x.prototype),x.prototype[a]=function(){return this},e.AsyncIterator=x,e.async=function(t,n,r,s){var i=new x(c(t,n,r,s));return e.isGeneratorFunction(n)?i:i.next().then(function(e){return e.done?e.value:i.next()})},k(_),_[o]="Generator",_[i]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,U.prototype={constructor:U,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function s(r,s){return o.type="throw",o.arg=e,n.next=r,s&&(n.method="next",n.arg=t),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var s=r.arg;E(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:S(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}});function l(e,t,n,r,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}var f=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var i=e.apply(t,n);function a(e){l(i,r,s,a,o,"next",e)}function o(e){l(i,r,s,a,o,"throw",e)}a(void 0)})}};var p=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}};var d=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)};var v=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var y=function(e){return p(e)||d(e)||v()};var g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e};var b=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},_=n(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(r){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=n=function(e){return t(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},n(r)}e.exports=n}),k=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},x=Object.prototype.toString;function C(e){return"[object Array]"===x.call(e)}function R(e){return null!==e&&"object"==typeof e}function E(e){return"[object Function]"===x.call(e)}function U(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),C(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}var S={isArray:C,isArrayBuffer:function(e){return"[object ArrayBuffer]"===x.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:R,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===x.call(e)},isFile:function(e){return"[object File]"===x.call(e)},isBlob:function(e){return"[object Blob]"===x.call(e)},isFunction:E,isStream:function(e){return R(e)&&E(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:U,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,s=arguments.length;r<s;r++)U(arguments[r],n);return t},extend:function(e,t,n){return U(t,function(t,r){e[r]=n&&"function"==typeof t?k(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},O=function(e,t,n,r,s){return function(e,t,n,r,s){return e.config=t,n&&(e.code=n),e.request=r,e.response=s,e}(new Error(e),t,n,r,s)};function A(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var I=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],D=S.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=S.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},j=S.isStandardBrowserEnv()?{write:function(e,t,n,r,s,i){var a=[];a.push(e+"="+encodeURIComponent(t)),S.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),S.isString(r)&&a.push("path="+r),S.isString(s)&&a.push("domain="+s),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},L=function(e){return new Promise(function(t,n){var r=e.data,s=e.headers;S.isFormData(r)&&delete s["Content-Type"];var i=new XMLHttpRequest;if(e.auth){var a=e.auth.username||"",o=e.auth.password||"";s.Authorization="Basic "+btoa(a+":"+o)}if(i.open(e.method.toUpperCase(),function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(S.isURLSearchParams(t))r=t.toString();else{var s=[];S.forEach(t,function(e,t){null!=e&&(S.isArray(e)?t+="[]":e=[e],S.forEach(e,function(e){S.isDate(e)?e=e.toISOString():S.isObject(e)&&(e=JSON.stringify(e)),s.push(A(t)+"="+A(e))}))}),r=s.join("&")}return r&&(e+=(-1===e.indexOf("?")?"?":"&")+r),e}(e.url,e.params,e.paramsSerializer),!0),i.timeout=e.timeout,i.onreadystatechange=function(){if(i&&4===i.readyState&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))){var r,s,a,o,c,u="getAllResponseHeaders"in i?(r=i.getAllResponseHeaders(),c={},r?(S.forEach(r.split("\n"),function(e){if(o=e.indexOf(":"),s=S.trim(e.substr(0,o)).toLowerCase(),a=S.trim(e.substr(o+1)),s){if(c[s]&&I.indexOf(s)>=0)return;c[s]="set-cookie"===s?(c[s]?c[s]:[]).concat([a]):c[s]?c[s]+", "+a:a}}),c):c):null,h={data:e.responseType&&"text"!==e.responseType?i.response:i.responseText,status:i.status,statusText:i.statusText,headers:u,config:e,request:i};!function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(O("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}(t,n,h),i=null}},i.onerror=function(){n(O("Network Error",e,null,i)),i=null},i.ontimeout=function(){n(O("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",i)),i=null},S.isStandardBrowserEnv()){var c=j,u=(e.withCredentials||D(e.url))&&e.xsrfCookieName?c.read(e.xsrfCookieName):void 0;u&&(s[e.xsrfHeaderName]=u)}if("setRequestHeader"in i&&S.forEach(s,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete s[t]:i.setRequestHeader(t,e)}),e.withCredentials&&(i.withCredentials=!0),e.responseType)try{i.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&i.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&i.upload&&i.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){i&&(i.abort(),n(e),i=null)}),void 0===r&&(r=null),i.send(r)})},T={"Content-Type":"application/x-www-form-urlencoded"};function P(e,t){!S.isUndefined(e)&&S.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var M,F={adapter:("undefined"!=typeof XMLHttpRequest?M=L:"undefined"!=typeof process&&(M=L),M),transformRequest:[function(e,t){return function(e,t){S.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})}(t,"Content-Type"),S.isFormData(e)||S.isArrayBuffer(e)||S.isBuffer(e)||S.isStream(e)||S.isFile(e)||S.isBlob(e)?e:S.isArrayBufferView(e)?e.buffer:S.isURLSearchParams(e)?(P(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):S.isObject(e)?(P(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};F.headers={common:{Accept:"application/json, text/plain, */*"}},S.forEach(["delete","get","head"],function(e){F.headers[e]={}}),S.forEach(["post","put","patch"],function(e){F.headers[e]=S.merge(T)});var B=F;function q(){this.handlers=[]}q.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},q.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},q.prototype.forEach=function(e){S.forEach(this.handlers,function(t){null!==t&&e(t)})};var N=q,H=function(e,t,n){return S.forEach(n,function(n){e=n(e,t)}),e},z=function(e){return!(!e||!e.__CANCEL__)};function W(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var J=function(e){var t,n,r;return W(e),e.baseURL&&(r=e.url,!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(r))&&(e.url=(t=e.baseURL,(n=e.url)?t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):t)),e.headers=e.headers||{},e.data=H(e.data,e.headers,e.transformRequest),e.headers=S.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),S.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||B.adapter)(e).then(function(t){return W(e),t.data=H(t.data,t.headers,e.transformResponse),t},function(t){return z(t)||(W(e),t&&t.response&&(t.response.data=H(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})};function G(e){this.defaults=e,this.interceptors={request:new N,response:new N}}G.prototype.request=function(e){"string"==typeof e&&(e=S.merge({url:arguments[0]},arguments[1])),(e=S.merge(B,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[J,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},S.forEach(["delete","get","head","options"],function(e){G.prototype[e]=function(t,n){return this.request(S.merge(n||{},{method:e,url:t}))}}),S.forEach(["post","put","patch"],function(e){G.prototype[e]=function(t,n,r){return this.request(S.merge(r||{},{method:e,url:t,data:n}))}});var V=G;function $(e){this.message=e}$.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},$.prototype.__CANCEL__=!0;var X=$;function Y(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new X(e),t(n.reason))})}Y.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Y.source=function(){var e;return{token:new Y(function(t){e=t}),cancel:e}};var K=Y;function Q(e){var t=new V(e),n=k(V.prototype.request,t);return S.extend(n,V.prototype,t),S.extend(n,t),n}var Z=Q(B);Z.Axios=V,Z.create=function(e){return Q(S.merge(B,e))},Z.Cancel=X,Z.CancelToken=K,Z.isCancel=z,Z.all=function(e){return Promise.all(e)},Z.spread=function(e){return function(t){return e.apply(null,t)}};var ee=Z,te=Z;ee.default=te;for(var ne=ee,re=n(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}}),se=[],ie=0;ie<256;++ie)se[ie]=(ie+256).toString(16).substr(1);var ae=function(e,t){var n=t||0,r=se;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")};var oe=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||re)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var i=0;i<16;++i)t[r+i]=s[i];return t||ae(s)},ce=n(function(e,t){!function(){var t=function e(t){var n,r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),s=60103,i={use_static:!1};function a(e){var t=Object.getPrototypeOf(e);return t?Object.create(t):{}}function o(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:n})}function c(e,t){o(e,t,function(){throw new g("The "+t+" method cannot be invoked on an Immutable data structure.")})}"object"!=typeof(n=t)||Array.isArray(n)||null===n||void 0!==t.use_static&&(i.use_static=Boolean(t.use_static));var u="__immutable_invariants_hold";function h(e){return"object"!=typeof e||null===e||Boolean(Object.getOwnPropertyDescriptor(e,u))}function l(e,t){return e===t||e!=e&&t!=t}function f(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var p=["setPrototypeOf"],d=p.concat(["push","pop","sort","splice","shift","unshift","reverse"]),v=["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]),y=p.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);function g(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function m(e,t){for(var n in o(e,u,!0),t)t.hasOwnProperty(n)&&c(e,t[n]);return Object.freeze(e),e}function w(e,t){var n=e[t];o(e,t,function(){return G(n.apply(e,arguments))})}function b(e,t,n){var r=n&&n.deep;if(e in this&&(r&&this[e]!==t&&f(t)&&f(this[e])&&(t=G.merge(this[e],t,{deep:!0,mode:"replace"})),l(this[e],t)))return this;var s=U.call(this);return s[e]=G(t),x(s)}g.prototype=new Error,g.prototype.constructor=Error;var _=G([]);function k(e,t,n){var r=e[0];if(1===e.length)return b.call(this,r,t,n);var s,i=e.slice(1),a=this[r];if("object"==typeof a&&null!==a)s=G.setIn(a,i,t);else{var o=i[0];s=""!==o&&isFinite(o)?k.call(_,i,t):M.call(P,i,t)}if(r in this&&a===s)return this;var c=U.call(this);return c[r]=s,x(c)}function x(e){for(var t in v)v.hasOwnProperty(t)&&w(e,v[t]);i.use_static||(o(e,"flatMap",R),o(e,"asObject",S),o(e,"asMutable",U),o(e,"set",b),o(e,"setIn",k),o(e,"update",B),o(e,"updateIn",N),o(e,"getIn",H));for(var n=0,r=e.length;n<r;n++)e[n]=G(e[n]);return m(e,d)}function C(){return new Date(this.getTime())}function R(e){if(0===arguments.length)return this;var t,n=[],r=this.length;for(t=0;t<r;t++){var s=e(this[t],t,this);Array.isArray(s)?n.push.apply(n,s):n.push(s)}return x(n)}function E(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var t=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);t.forEach(function(e,t,n){"number"==typeof e&&(n[t]=e.toString())}),e=function(e,n){return-1!==t.indexOf(n)}}var n=a(this);for(var r in this)this.hasOwnProperty(r)&&!1===e(this[r],r)&&(n[r]=this[r]);return J(n)}function U(e){var t,n,r=[];if(e&&e.deep)for(t=0,n=this.length;t<n;t++)r.push(O(this[t]));else for(t=0,n=this.length;t<n;t++)r.push(this[t]);return r}function S(e){"function"!=typeof e&&(e=function(e){return e});var t,n={},r=this.length;for(t=0;t<r;t++){var s=e(this[t],t,this),i=s[0],a=s[1];n[i]=a}return J(n)}function O(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,u)||e instanceof Date?e:G.asMutable(e,{deep:!0})}function A(e,t){for(var n in e)Object.getOwnPropertyDescriptor(e,n)&&(t[n]=e[n]);return t}function I(e,t){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var n,r,s=Array.isArray(e),i=t&&t.deep,o=t&&t.mode||"merge",c=t&&t.merger;function u(e,r,s){var o,u=G(r[s]),h=c&&c(e[s],u,t),p=e[s];void 0===n&&void 0===h&&e.hasOwnProperty(s)&&l(u,p)||l(p,o=void 0!==h?h:i&&f(p)&&f(u)?G.merge(p,u,t):u)&&e.hasOwnProperty(s)||(void 0===n&&(n=A(e,a(e))),n[s]=o)}if(s)for(var h=0,p=e.length;h<p;h++){var d=e[h];for(r in d)d.hasOwnProperty(r)&&u(void 0!==n?n:this,d,r)}else{for(r in e)Object.getOwnPropertyDescriptor(e,r)&&u(this,e,r);"replace"===o&&function(e,t){for(var r in e)t.hasOwnProperty(r)||(void 0===n&&(n=A(e,a(e))),delete n[r])}(this,e)}return void 0===n?this:J(n)}function D(e,t){var n=t&&t.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return G.merge(this,e,{deep:n,mode:"replace"})}var j,L,T,P=G({});function M(e,t,n){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var r=e[0];if(1===e.length)return F.call(this,r,t,n);var s,i=e.slice(1),o=this[r];if(s=this.hasOwnProperty(r)&&"object"==typeof o&&null!==o?G.setIn(o,i,t):M.call(P,i,t),this.hasOwnProperty(r)&&o===s)return this;var c=A(this,a(this));return c[r]=s,J(c)}function F(e,t,n){var r=n&&n.deep;if(this.hasOwnProperty(e)&&(r&&this[e]!==t&&f(t)&&f(this[e])&&(t=G.merge(this[e],t,{deep:!0,mode:"replace"})),l(this[e],t)))return this;var s=A(this,a(this));return s[e]=G(t),J(s)}function B(e,t){var n=Array.prototype.slice.call(arguments,2),r=this[e];return G.set(this,e,t.apply(r,[r].concat(n)))}function q(e,t){for(var n=0,r=t.length;null!=e&&n<r;n++)e=e[t[n]];return n&&n==r?e:void 0}function N(e,t){var n=Array.prototype.slice.call(arguments,2),r=q(this,e);return G.setIn(this,e,t.apply(r,[r].concat(n)))}function H(e,t){var n=q(this,e);return void 0===n?t:n}function z(e){var t,n=a(this);if(e&&e.deep)for(t in this)this.hasOwnProperty(t)&&(n[t]=O(this[t]));else for(t in this)this.hasOwnProperty(t)&&(n[t]=this[t]);return n}function W(){return{}}function J(e){return i.use_static||(o(e,"merge",I),o(e,"replace",D),o(e,"without",E),o(e,"asMutable",z),o(e,"set",F),o(e,"setIn",M),o(e,"update",B),o(e,"updateIn",N),o(e,"getIn",H)),m(e,p)}function G(e,t,n){if(h(e)||function(e){return"object"==typeof e&&null!==e&&(e.$$typeof===s||e.$$typeof===r)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then(G);if(Array.isArray(e))return x(e.slice());if(e instanceof Date)return a=new Date(e.getTime()),i.use_static||o(a,"asMutable",C),m(a,y);var a,c=t&&t.prototype,u=(c&&c!==Object.prototype?function(){return Object.create(c)}:W)();if(null==n&&(n=64),n<=0)throw new g("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");for(var l in n-=1,e)Object.getOwnPropertyDescriptor(e,l)&&(u[l]=G(e[l],void 0,n));return J(u)}function V(e){return function(){var t=[].slice.call(arguments),n=t.shift();return e.apply(n,t)}}function $(e,t){return function(){var n=[].slice.call(arguments),r=n.shift();return Array.isArray(r)?t.apply(r,n):e.apply(r,n)}}return G.from=G,G.isImmutable=h,G.ImmutableError=g,G.merge=V(I),G.replace=V(D),G.without=V(E),G.asMutable=(j=z,L=U,T=C,function(){var e=[].slice.call(arguments),t=e.shift();return Array.isArray(t)?L.apply(t,e):t instanceof Date?T.apply(t,e):j.apply(t,e)}),G.set=$(F,b),G.setIn=$(M,k),G.update=V(B),G.updateIn=V(N),G.getIn=V(H),G.flatMap=V(R),G.asObject=V(S),i.use_static||(G.static=e({use_static:!0})),Object.freeze(G),G}();e.exports=t}()});ce.Immutable;function ue(e,t){return e.created_at-t.created_at}var he=function(){function e(t){g(this,e),b(this,"removeMessageFromArray",function(e,t){var n=!1,r=e.flatMap(function(e){return e.id&&t.id&&e.id===t.id?(n=!0,[]):e});return{removed:n,result:r}}),this._channel=t,this.watcher_count=0,this.typing=ce({}),this.read=ce({}),this.messages=ce([]),this.threads=ce({}),this.mutedUsers=ce([]),this.watchers=ce({}),this.members=ce({}),this.membership=ce({}),this.last_message_at=null!=t.last_message_at?new Date(t.last_message_at):null}return w(e,[{key:"addMessageSorted",value:function(e){return this.addMessagesSorted([e])}},{key:"messageToImmutable",value:function(e){return e.__html=e.html,e.created_at=new Date(e.created_at),e.updated_at=new Date(e.updated_at),e.status||(e.status="received"),ce(e)}},{key:"addMessagesSorted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],r=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var c=a.value;t&&this.threads[c.id]&&(this.threads=ce.without(this.threads,c.id));var u=this.messageToImmutable(c);n.push(u),u.created_at>this.last_message_at&&(this.last_message_at=u.created_at)}}catch(e){s=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(s)throw i}}for(var h=[],l=0,f=n;l<f.length;l++){var p=f[l];p.parent_id&&!p.show_in_channel||(this.messages=this._addToMessageList(this.messages,p));var d=p.parent_id;if(d){var v=this.threads[d]||ce([]),g=this._addToMessageList(v,p);this.threads=this.threads.set(d,g),h.push(d)}}var m=y(this.messages);m.sort(ue),this.messages=ce(m);for(var w=0,b=h;w<b.length;w++){var _=b[w],k=this.threads[_]?y(this.threads[_]):[];k.sort(ue),this.threads=this.threads.set(_,k)}}},{key:"addReaction",value:function(e,t){var n=this.messages;if(t){var r=t.parent_id,s=t.show_in_channel;if(r&&this.threads[r])for(var i=this.threads[r],a=0;a<i.length;a++){var o=i[a];if(o=this._addReactionToMessage(o,e)){this.threads=this.threads.set(r,i.set(a,o));break}}if(!s&&!r||s)for(var c=0;c<n.length;c++){var u=n[c];if(u=this._addReactionToMessage(u,e)){this.messages=n.set(c,u);break}}}}},{key:"_addReactionToMessage",value:function(e,t){return!(!e.id||e.id!==t.message_id)&&(e=this._removeReactionFromMessage(e,t),this._channel.getClient().userID===t.user.id&&(e=e.update("own_reactions",function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat([t])})),e=(e=e.update("latest_reactions",function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat([t])})).updateIn(["reaction_counts",t.type],function(e){return e?e+1:1}))}},{key:"_removeReactionFromMessage",value:function(e,t){var n=function(e){return e.filter(function(e){return e.type!==t.type||e.user.id!==t.user.id})};return e=(e=e.update("own_reactions",n)).update("latest_reactions",n)}},{key:"removeReaction",value:function(e,t){var n=this.messages;if(t){var r=t.parent_id,s=t.show_in_channel;if(r&&this.threads[r])for(var i=this.threads[r],a=0;a<i.length;a++){var o=i[a];if(o.id&&o.id===e.message_id){o=(o=this._removeReactionFromMessage(o,e)).updateIn(["reaction_counts",e.type],function(e){return e?e-1:0}),this.threads=this.threads.set(r,i.set(a,o));break}}if(!s&&!r||s)for(var c=0;c<n.length;c++){var u=n[c];if(u.id&&u.id===e.message_id){u=(u=this._removeReactionFromMessage(u,e)).updateIn(["reaction_counts",e.type],function(e){return e?e-1:0}),this.messages=n.set(c,u);break}}}}},{key:"_addToMessageList",value:function(e,t){for(var n=!1,r=0;r<e.length;r++){var s=e[r];s.id&&t.id&&s.id===t.id&&(e=e.set(r,t),n=!0)}return n||(e=e.concat([t])),e}},{key:"removeMessage",value:function(e){var t=!1;if(e.parent_id&&this.threads[e.parent_id]){var n=this.removeMessageFromArray(this.threads[e.parent_id],e),r=n.removed,s=n.result;this.threads=this.threads[e.parent_id].set(e.parent_id,s),t=r}else{var i=this.removeMessageFromArray(this.messages,e),a=i.removed,o=i.result;this.messages=o,t=a}return t}},{key:"filterErrorMessages",value:function(){var e=this.messages.flatMap(function(e){return"error"!==e.type?e:[]});this.messages=ce(e)}},{key:"clean",value:function(){for(var e=new Date,t=0,n=Object.entries(this.typing);t<n.length;t++){var r=o(n[t],2),s=r[0],i=r[1];e-new Date(i.received_at)>7e3&&(this.typing=this.typing.without(s),this._channel.getClient().dispatchEvent({type:"typing.stop",user:{id:s},cid:this._channel.cid}))}}},{key:"clearMessages",value:function(){this.messages=ce([])}}]),e}(),le={"user.presence.changed":!0,"user.watching.start":!0,"user.watching.stop":!0,"user.updated":!0,"typing.start":!0,"typing.stop":!0,"message.new":!0,"message.updated":!0,"message.deleted":!0,"message.read":!0,"reaction.new":!0,"reaction.deleted":!0,"member.added":!0,"member.updated":!0,"member.removed":!0,"channel.updated":!0,"channel.muted":!0,"channel.unmuted":!0,"channel.deleted":!0,"channel.truncated":!0,"channel.created":!0,"channel.hidden":!0,"health.check":!0,"notification.message_new":!0,"notification.mark_read":!0,"notification.invited":!0,"notification.invite_accepted":!0,"notification.added_to_channel":!0,"notification.removed_from_channel":!0,"notification.mutes_updated":!0,"notification.channel_deleted":!0,"notification.channel_truncated":!0,"notification.channel_mutes_updated":!0,"connection.changed":!0,"connection.recovered":!0};function fe(e){return"all"===e||(le[e]||!1)}function pe(e,t){e.then(function(){}).catch(function(e){console.warn("failed to do ".concat(t,", ran into error: "),e)})}var de=function(e){return new Promise(function(t){return setTimeout(t,e)})};function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(n,!0).forEach(function(t){b(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ge=function(){function e(t,n,r,s){var i=this;g(this,e),b(this,"create",f(h.mark(function e(){var t;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={watch:!1,state:!1,presence:!1},e.next=3,i.query(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))),b(this,"_callChannelListeners",function(e){var t=i,n=[];t.listeners.all&&n.push.apply(n,y(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,y(t.listeners[e.type]));for(var r=0,s=n;r<s.length;r++){(0,s[r])(e)}}),b(this,"_channelURL",function(){if(!i.id)throw new Error("channel id is not defined");return"".concat(i.getClient().baseURL,"/channels/").concat(i.type,"/").concat(i.id)});if(!/^[\w_-]+$/.test(n))throw new Error("Invalid chat type ".concat(n,', letters, numbers and "_-" are allowed'));if(!/^[\w!_-]+$/.test(r))throw new Error("Invalid chat id ".concat(r,', letters, numbers and "!-_" are allowed'));this._client=t,this.type=n,this.id=r,this.data=s,this._data=ye({},s),this.cid="".concat(n,":").concat(r),this.listeners={},this.state=new he(this),this.initialized=!1,this.lastTypingEvent=null,this.isTyping=!1,this.disconnected=!1}return w(e,[{key:"getClient",value:function(){if(!0===this.disconnected)throw Error("You can't use a channel after client.disconnect() was called");return this._client}},{key:"getConfig",value:function(){return this.getClient().configs[this.type]}},{key:"sendMessage",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/message",{message:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendFile",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/file"),e,t,n,r)}},{key:"sendImage",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/image"),e,t,n,r)}},{key:"deleteFile",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/file"),{url:e})}},{key:"deleteImage",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/image"),{url:e})}},{key:"sendEvent",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().post(this._channelURL()+"/event",{event:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=f(h.mark(function e(t){var n,r,s=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},r=ye({filter_conditions:{cid:this.cid}},n),"string"!=typeof t){e.next=6;break}r.query=t,e.next=11;break;case 6:if("object"!==_(t)){e.next=10;break}r.message_filter_conditions=t,e.next=11;break;case 10:throw Error("Invalid type ".concat(_(t)," for query parameter"));case 11:return e.next=13,this.wsPromise;case 13:return e.next=15,this.getClient().get(this.getClient().baseURL+"/search",{payload:r});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendReaction",value:function(){var e=f(h.mark(function e(t,n,r){var s;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Message id is missing");case 2:if(n&&0!==Object.keys(n).length){e.next=4;break}throw Error("Reaction object is missing");case 4:return s={reaction:n},null!=r&&(s.reaction=ye({},n,{user:{id:r}})),e.next=8,this.getClient().post(this.getClient().baseURL+"/messages/".concat(t,"/reaction"),s);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteReaction",value:function(e,t,n){if(this._checkInitialized(),!t||!e)throw Error("Deleting a reaction requires specifying both the message and reaction type");var r=this.getClient().baseURL+"/messages/".concat(e,"/reaction/").concat(t);return n?this.getClient().delete(r,{user_id:n}):this.getClient().delete(r)}},{key:"update",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{message:n,data:t});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=f(h.mark(function e(){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().delete(this._channelURL());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=f(h.mark(function e(){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/truncate");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"acceptInvite",value:function(){var e=f(h.mark(function e(){var t,n,r=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getClient().post(this._channelURL(),ye({accept_invite:!0},t));case 3:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rejectInvite",value:function(){var e=f(h.mark(function e(){var t,n,r=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getClient().post(this._channelURL(),ye({reject_invite:!0},t));case 3:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addMembers",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{add_members:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addModerators",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{add_moderators:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"inviteMembers",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{invites:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMembers",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{remove_members:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"demoteModerators",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{demote_moderators:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"mute",value:function(){var e=f(h.mark(function e(){var t,n=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/mute/channel",ye({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"unmute",value:function(){var e=f(h.mark(function e(){var t,n=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/unmute/channel",ye({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"muteStatus",value:function(){return this._checkInitialized(),this.getClient()._muteStatus(this.cid)}},{key:"sendAction",value:function(e,t){if(this._checkInitialized(),!e)throw Error("Message id is missing");return this.getClient().post(this.getClient().baseURL+"/messages/".concat(e,"/action"),{message_id:e,form_data:t,id:this.id,type:this.type})}},{key:"keystroke",value:function(){var e=f(h.mark(function e(){var t,n;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getConfig().typing_events){e.next=2;break}return e.abrupt("return");case 2:if(t=new Date,n=t-this.lastTypingEvent,this.lastKeyStroke=t,this.isTyping=!0,!(n>2e3)){e.next=10;break}return this.lastTypingEvent=new Date,e.next=10,this.sendEvent({type:"typing.start"});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"stopTyping",value:function(){var e=f(h.mark(function e(){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getConfig().typing_events){e.next=2;break}return e.abrupt("return");case 2:return this.lastTypingEvent=null,this.isTyping=!1,e.next=6,this.sendEvent({type:"typing.stop"});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"lastMessage",value:function(){var e=this.state.messages.length-5;e<0&&(e=0);var t,n=this.state.messages.length+1,r=this.state.messages.slice(e,n).asMutable();return r.sort(function(e,t){return t.created_at-e.created_at}),r.length>0&&(t=r[0]),t}},{key:"markRead",value:function(){var e=f(h.mark(function e(){var t,n=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this._checkInitialized(),this.getConfig().read_events){e.next=4;break}return e.abrupt("return",Promise.resolve(null));case 4:return e.next=6,this.getClient().post(this._channelURL()+"/read",ye({},t));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"clean",value:function(){this.lastKeyStroke&&(new Date-this.lastKeyStroke>1e3&&this.isTyping&&pe(this.stopTyping(),"stop typing event"));this.state.clean()}},{key:"watch",value:function(){var e=f(h.mark(function e(t){var n,r,s;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={state:!0,watch:!0,presence:!1},e.next=3,this.getClient().wsPromise;case 3:return this.getClient()._hasConnectionID()||(n.watch=!1),r=ye({},n,{},t),e.next=7,this.query(r);case 7:return s=e.sent,this.initialized=!0,this._initializeState(s),this.data=s.channel,this._client.logger("info","channel:watch() - started watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",s);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopWatching",value:function(){var e=f(h.mark(function e(){var t;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/stop-watching",{});case 2:return t=e.sent,this._client.logger("info","channel:watch() - stopped watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getReplies",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().get(this.getClient().baseURL+"/messages/".concat(t,"/replies"),ye({},n));case 2:return(r=e.sent).messages&&this.state.addMessagesSorted(r.messages),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getReactions",value:function(e,t){return this.getClient().get(this.getClient().baseURL+"/messages/".concat(e,"/reactions"),ye({},t))}},{key:"getMessagesById",value:function(e){return this.getClient().get(this._channelURL()+"/messages",{ids:e.join(",")})}},{key:"lastRead",value:function(){return this._checkInitialized(),this.state.read[this.getClient().userID]?this.state.read[this.getClient().userID].last_read:null}},{key:"countUnread",value:function(e){null==e&&(e=this.lastRead());var t=0,n=!0,r=!1,s=void 0;try{for(var i,a=this.state.messages[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var o=i.value;this.getClient().userID!==o.user.id&&(null!=e?o.created_at>e&&t++:t++)}}catch(e){r=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw s}}return t}},{key:"countUnreadMentions",value:function(){var e=this,t=this.lastRead(),n=0,r=!0,s=!1,i=void 0;try{for(var a,o=this.state.messages[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var c=a.value;this.getClient().userID!==c.user.id&&(null!=t?c.created_at>t&&function(){var t=e.getClient().userID;-1!==c.mentioned_users.findIndex(function(e){return e.id===t})&&n++}():n++)}}catch(e){s=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(s)throw i}}return n}},{key:"query",value:function(){var e=f(h.mark(function e(t){var n,r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().wsPromise;case 2:return n="".concat(this.getClient().baseURL,"/channels/").concat(this.type),this.id&&(n+="/".concat(this.id)),e.next=6,this.getClient().post(n+"/query",ye({data:this._data,state:!0},t));case 6:return r=e.sent,this.id||(this.id=r.channel.id,this.cid=r.channel.cid,this.cid in this.getClient().activeChannels||(this.getClient().activeChannels[this.cid]=this)),this.getClient()._addChannelConfig(r),this._initializeState(r),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"banUser",value:function(){var e=f(h.mark(function e(t,n){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().banUser(t,ye({},n,{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"hide",value:function(){var e=f(h.mark(function e(){var t,n,r=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]&&r[1],this._checkInitialized(),e.next=5,this.getClient().post("".concat(this._channelURL(),"/hide"),{user_id:t,clear_history:n});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"show",value:function(){var e=f(h.mark(function e(){var t,n=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._checkInitialized(),e.next=4,this.getClient().post("".concat(this._channelURL(),"/show"),{user_id:t});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"unbanUser",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().unbanUser(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){var n=t?e:"all";if(!fe(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Attaching listener for ".concat(n," event on channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n].push(r)}},{key:"off",value:function(e,t){var n=t?e:"all";if(!fe(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Removing listener for ".concat(n," event from channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n]=this.listeners[n].filter(function(e){return e!==r})}},{key:"_handleChannelEvent",value:function(e){this._client.logger("info","channel:_handleChannelEvent - Received event of type { ".concat(e.type," } on ").concat(this.cid),{tags:["event","channel"],channel:this});var t=this.state;switch(e.type){case"typing.start":t.typing=t.typing.set(e.user.id,ce(e));break;case"typing.stop":t.typing=t.typing.without(e.user.id);break;case"message.read":t.read=t.read.set(e.user.id,ce({user:ye({},e.user),last_read:e.received_at}));break;case"user.watching.start":case"user.updated":t.watchers=t.watchers.set(e.user.id,ce(e.user));break;case"user.watching.stop":t.watchers=t.watchers.without(e.user.id);break;case"message.new":case"message.updated":case"message.deleted":t.addMessageSorted(e.message);break;case"channel.truncated":t.clearMessages();break;case"member.added":case"member.updated":t.members=t.members.set(e.member.user_id,ce(e.member));break;case"member.removed":t.members=t.members.without(e.user.id);break;case"channel.updated":this.data=ce(e.channel);break;case"reaction.new":t.addReaction(e.reaction,e.message);break;case"reaction.deleted":t.removeReaction(e.reaction,e.message);break;case"channel.hidden":e.clear_history&&t.clearMessages()}void 0!==e.watcher_count&&(this.state.watcher_count=e.watcher_count)}},{key:"_checkInitialized",value:function(){if(!this.initialized&&!this.getClient()._isUsingServerAuth())throw Error("Channel ".concat(this.cid," hasn't been initialized yet. Make sure to call .watch() and wait for it to resolve"))}},{key:"_initializeState",value:function(e){if(e.members){var t=!0,n=!1,s=void 0;try{for(var i,a=e.members[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.getClient().state.updateUserReference(o.user,this.cid)}}catch(e){n=!0,s=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw s}}}if(this.state.membership=ce(e.membership?e.membership:{}),e.watchers){var c=!0,u=!1,h=void 0;try{for(var l,f=e.watchers[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var p=l.value;this.getClient().state.updateUserReference(p.user,this.cid)}}catch(e){u=!0,h=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw h}}}var d=e.messages||[];if(this.state.messages||(this.state.messages=ce([])),this.state.addMessagesSorted(d,!0),this.state.watcher_count=e.watcher_count,e.watchers){var v=!0,y=!1,g=void 0;try{for(var m,w=e.watchers[Symbol.iterator]();!(v=(m=w.next()).done);v=!0){var b=m.value;this.state.watchers=this.state.watchers.set(b.id,b)}}catch(e){y=!0,g=e}finally{try{v||null==w.return||w.return()}finally{if(y)throw g}}}if(null!=this.getClient().userID){var _=null!=this.state.last_message_at?this.state.last_message_at:new Date;this.state.read=this.state.read.set(this.getClient().user.id,{last_read:_})}if(e.read){var k=!0,x=!1,C=void 0;try{for(var R,E=e.read[Symbol.iterator]();!(k=(R=E.next()).done);k=!0){var U=R.value,S=r(ye({},U));S.last_read=new Date(U.last_read),this.state.read=this.state.read.set(U.user.id,S)}}catch(e){x=!0,C=e}finally{try{k||null==E.return||E.return()}finally{if(x)throw C}}}if(e.members){var O=!0,A=!1,I=void 0;try{for(var D,j=e.members[Symbol.iterator]();!(O=(D=j.next()).done);O=!0){var L=D.value;this.state.members=this.state.members.set(L.user.id,L)}}catch(e){A=!0,I=e}finally{try{O||null==j.return||j.return()}finally{if(A)throw I}}}}},{key:"_disconnect",value:function(){this._client.logger("info","channel:disconnect() - Disconnecting the channel ".concat(this.cid),{tags:["connection","channel"],channel:this}),this.disconnected=!0}}]),e}(),me=function(){function e(){g(this,e),this.users=ce({}),this.userChannelReferences={}}return w(e,[{key:"updateUsers",value:function(e){var t=!0,n=!1,r=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var a=s.value;this.updateUser(a)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"updateUser",value:function(e){null!=e&&(this.users=this.users.set(e.id,ce(e)))}},{key:"updateUserReference",value:function(e,t){null!=e&&(this.updateUser(e),this.userChannelReferences[e.id]||(this.userChannelReferences[e.id]={}),this.userChannelReferences[e.id][t]=!0)}}]),e}(),we=null;"undefined"!=typeof WebSocket?we=WebSocket:"undefined"!=typeof MozWebSocket?we=MozWebSocket:void 0!==t?we=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?we=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(we=self.WebSocket||self.MozWebSocket);for(var be=we,_e=function(){function e(t){var n=this,r=t.wsURL,s=t.clientID,i=t.userID,a=t.messageCallback,o=t.recoverCallback,c=t.eventCallback,u=t.logger;g(this,e),b(this,"onlineStatusChanged",function(e){"offline"===e.type?(n.logger("info","connection:onlineStatusChanged() - Status changing to offline",{tags:["connection"]}),n._setHealth(!1)):"online"===e.type&&(n.logger("info","connection:onlineStatusChanged() - Status changing to online. isHealthy: ".concat(n.isHealthy),{tags:["connection"]}),n.isHealthy||n._reconnect(10))}),b(this,"onopen",function(e){n.wsID===e&&(n.logger("info","connection:onopen() - onopen callback",{tags:["connection"],wsID:e}),n._setHealth(!0))}),b(this,"onmessage",function(e,t){n.wsID===e&&(n.isResolved||n.resolvePromise(t),n.lastEvent=new Date,n.logger("info","connection:onmessage() - onmessage callback",{tags:["connection"],event:t,wsID:e}),n.messageCallback(t))}),b(this,"onclose",function(e,t){if(n.logger("info","connection:onclose() - onclose callback",{tags:["connection"],event:t,wsID:e}),n.wsID===e)if(1e3===t.code){var r=new Error("WS connection reject with error ".concat(t.reason));r.reason=t.reason,n.rejectPromise(r),n.logger("info","connection:onclose() - WS connection reject with error ".concat(t.reason),{tags:["connection"],event:t})}else n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.rejectPromise(n._errorFromWSEvent(t)),n.logger("info","connection:onclose() - WS connection closed. Calling reconnect ...",{tags:["connection"],event:t}),n._reconnect()}),b(this,"onerror",function(e,t){n.wsID===e&&(n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.rejectPromise(n._errorFromWSEvent(t)),n.logger("info","connection:onerror() - WS connection resulted into error",{tags:["connection"],event:t}),n._reconnect())}),b(this,"_setHealth",function(e){e&&!n.isHealthy&&(n.isHealthy=!0,n.eventCallback({type:"connection.changed",online:!0})),!e&&n.isHealthy&&(n.isHealthy=!1,setTimeout(function(){n.isHealthy||n.eventCallback({type:"connection.changed",online:!1})},5e3))}),b(this,"_errorFromWSEvent",function(e){n.logger("error","connection:_errorFromWSEvent() - WS failed with code ".concat(e.code),{tags:["connection"],event:e});var t=new Error("WS failed with code ".concat(e.code));return t.code=e.code,t.isWSFailure=!0,t}),b(this,"_listenForConnectionChanges",function(){"undefined"!=typeof window&&null!=window&&null!=window.addEventListener&&(window.addEventListener("offline",n.onlineStatusChanged),window.addEventListener("online",n.onlineStatusChanged))}),b(this,"_removeConnectionListeners",function(){"undefined"!=typeof window&&null!=window&&null!=window.addEventListener&&(window.removeEventListener("offline",n.onlineStatusChanged),window.removeEventListener("online",n.onlineStatusChanged))}),b(this,"_setupConnectionPromise",function(){var e=n;n.isResolved=!1,n.connectionOpen=new Promise(function(t,n){e.resolvePromise=t,e.rejectPromise=n}).then(function(e){var t=JSON.parse(e.data);if(null!=t.error)throw new Error(JSON.stringify(t.error));return t})}),this.wsURL=r,this.clientID=s,this.userID=i,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isHealthy=!1,this.recoverCallback=o,this.messageCallback=a,this.eventCallback=c,this.logger=u,this.wsID=1,this.lastEvent=null,this.healthCheckInterval=3e4,this.monitorInterval=1e3,this._listenForConnectionChanges()}return w(e,[{key:"connect",value:function(){var e=f(h.mark(function e(){var t;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isConnecting){e.next=2;break}throw Error("You've called connect twice, can only attempt 1 connection at the time");case 2:return e.prev=2,this.isConnecting=!0,e.next=6,this._connect();case 6:return t=e.sent,this.isConnecting=!1,this.consecutiveFailures=0,this._startMonitor(),this._startHealthCheck(),this.logger("info","connection:connect() - Established ws connection with healthcheck: ".concat(t),{tags:["connection"]}),e.abrupt("return",t);case 15:if(e.prev=15,e.t0=e.catch(2),this.isConnecting=!1,e.t0.isWSFailure){e.next=20;break}throw e.t0;case 20:case"end":return e.stop()}},e,this,[[2,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e,t=this;this.logger("info","connection:disconnect() - Closing the websocket connection for wsID ".concat(this.wsID),{tags:["connection"]}),this.wsID+=1,this.healthCheckIntervalRef&&clearInterval(this.healthCheckIntervalRef),this.monitorIntervalRef&&clearInterval(this.monitorIntervalRef),this._removeConnectionListeners(),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();var n=this.ws;return n&&n.close&&n.readyState===n.OPEN?(e=new Promise(function(e){n.onclose=function(){t.logger("info","connection:disconnect() - resolving isClosedPromise",{tags:["connection"]}),e()}}),this.logger("info","connection:disconnect() - Manually closed connection by calling client.disconnect()",{tags:["connection"]}),n.close(1e3,"Manually closed connection by calling client.disconnect()")):(this.logger("info","connection:disconnect() - ws connection doesn't exist or it is already closed.",{tags:["connection"]}),e=Promise.resolve()),delete this.ws,e}},{key:"_connect",value:function(){var e=f(h.mark(function e(){var t;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._setupConnectionPromise(),this.ws=new be(this.wsURL),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID),e.next=8,this.connectionOpen;case 8:return t=e.sent,this.connectionID=t.connection_id,e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_reconnect",value:function(){var e=f(h.mark(function e(t){var n;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger("info","connection:_reconnect() - Initiating the reconnect",{tags:["connection"]}),!this.isConnecting&&!this.isHealthy){e.next=4;break}return this.logger("info","connection:_reconnect() - Abort (1) since already connecting or healthy",{tags:["connection"]}),e.abrupt("return");case 4:return void 0===t&&(t=this._retryInterval()),e.next=7,de(t);case 7:if(!this.isConnecting&&!this.isHealthy){e.next=10;break}return this.logger("info","connection:_reconnect() - Abort (2) since already connecting or healthy",{tags:["connection"]}),e.abrupt("return");case 10:return this.isConnecting=!0,this.logger("info","connection:_reconnect() - Destroying current WS connection",{tags:["connection"]}),this._destroyCurrentWSConnection(),e.prev=13,e.next=16,this._connect();case 16:if(n=e.sent,!this.recoverCallback){e.next=22;break}return this.logger("info","connection:_reconnect() - Waiting for recoverCallBack",{tags:["connection"]}),e.next=21,this.recoverCallback(n);case 21:this.logger("info","connection:_reconnect() - Finished recoverCallBack",{tags:["connection"]});case 22:this.isConnecting=!1,this.consecutiveFailures=0,e.next=30;break;case 26:e.prev=26,e.t0=e.catch(13),this.isConnecting=!1,e.t0.isWSFailure&&(this.logger("info","connection:_reconnect() - WS failure, so going to try to reconnect",{tags:["connection"]}),this._reconnect());case 30:this.logger("info","connection:_reconnect() - == END ==",{tags:["connection"]});case 31:case"end":return e.stop()}},e,this,[[13,26]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_destroyCurrentWSConnection",value:function(){this.wsID+=1;try{this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners(),this.ws&&this.ws.close&&this.ws.close()}catch(e){}}},{key:"_retryInterval",value:function(){var e=Math.min(500+2e3*this.consecutiveFailures,25e3),t=Math.min(Math.max(250,2e3*(this.consecutiveFailures-1)),25e3);return Math.floor(Math.random()*(e-t)+t)}},{key:"_startHealthCheck",value:function(){var e=this;this.healthCheckIntervalRef=setInterval(function(){var t=[{type:"health.check",client_id:e.clientID,user_id:e.userID}];try{e.ws.send(JSON.stringify(t))}catch(e){}},e.healthCheckInterval)}},{key:"_startMonitor",value:function(){var e=this,t=this;this.monitorIntervalRef=setInterval(function(){new Date-t.lastEvent>e.healthCheckInterval+1e4&&(e.logger("info","connection:_startMonitor - going to reconnect",{tags:["connection"]}),t._setHealth(!1),t._reconnect())},t.monitorInterval)}}]),e}(),ke=null,xe=null,Ce=function(e){for(var t,n=e.length,r=n%3,s=[],i=0,a=n-r;i<a;i+=16383)s.push(Ae(e,i,i+16383>a?a:i+16383));1===r?(t=e[n-1],s.push(Re[t>>2]+Re[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],s.push(Re[t>>10]+Re[t>>4&63]+Re[t<<2&63]+"="));return s.join("")},Re=[],Ee=[],Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Se=0,Oe=Ue.length;Se<Oe;++Se)Re[Se]=Ue[Se],Ee[Ue.charCodeAt(Se)]=Se;function Ae(e,t,n){for(var r,s,i=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(Re[(s=r)>>18&63]+Re[s>>12&63]+Re[s>>6&63]+Re[63&s]);return i.join("")}Ee["-".charCodeAt(0)]=62,Ee["_".charCodeAt(0)]=63;var Ie=function(e,t){for(var n,r=[],s=0,i=e.length;s<i;s++)"string"==typeof e&&e.charAt(s)?(n=t(e.charAt(s),s,e),r[s]=n):"string"!=typeof e&&s in e&&(n=t(e[s],s,e),r[s]=n);return r};function De(e){return Ce(Ie(e,function(e){return e.charCodeAt(0)}))}function je(e){var t,n,r,s={},i=String.fromCharCode,a=e.length,o=0,c=0,u="";for(t=0;t<64;t++)s["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;n<a;n++)for(o=(o<<6)+s[e.charAt(n)],c+=6;c>=8;)((r=o>>>(c-=8)&255)||n<a-2)&&(u+=i(r));return u}function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Te(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof t)throw new TypeError("userId should be a string");!function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(n,!0).forEach(function(t){b(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}}({user_id:t},n);throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.")}function Pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r({algorithm:"HS256",noTimestamp:!0},t);return ke.sign({server:!0},e,n)}function Me(e){var t=e.split(".");if(3!==t.length)return"";var n=je(t[1]);return JSON.parse(n).user_id}function Fe(e){return["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",De(JSON.stringify({user_id:e})),"devtoken"].join(".")}function Be(e,t,n){var r=Buffer.from(t,"ascii");return xe.createHmac("sha256",r).update(e).digest("hex")===n}var qe=null,Ne=null,He=n(function(e,n){var r=function(e){function t(){this.fetch=!1,this.DOMException=e.DOMException}return t.prototype=e,new t}("undefined"!=typeof self?self:t);!function(e){!function(t){var n={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(n.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};function i(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function a(e){return"string"!=typeof e&&(e=String(e)),e}function o(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n.iterable&&(t[Symbol.iterator]=function(){return t}),t}function c(e){this.map={},e instanceof c?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function u(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function l(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:n.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():n.arrayBuffer&&n.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||s(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?u(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(l)}),this.text=function(){var e,t,n,r=u(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}c.prototype.append=function(e,t){e=i(e),t=a(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},c.prototype.delete=function(e){delete this.map[i(e)]},c.prototype.get=function(e){return e=i(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(i(e))},c.prototype.set=function(e,t){this.map[i(e)]=a(t)},c.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},c.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),o(e)},c.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),o(e)},c.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),o(e)},n.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var d=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(e,t){var n,r,s=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),d.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function y(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),s=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(s))}}),t}function g(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},p.call(v.prototype),p.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var m=[301,302,303,307,308];g.redirect=function(e,t){if(-1===m.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function w(e,r){return new Promise(function(s,i){var a=new v(e,r);if(a.signal&&a.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function u(){o.abort()}o.onload=function(){var e,t,n={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new c,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var s=n.join(":").trim();t.append(r,s)}}),t)};n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");var r="response"in o?o.response:o.responseText;s(new g(r,n))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},o.open(a.method,a.url,!0),"include"===a.credentials?o.withCredentials=!0:"omit"===a.credentials&&(o.withCredentials=!1),"responseType"in o&&n.blob&&(o.responseType="blob"),a.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),a.signal&&(a.signal.addEventListener("abort",u),o.onreadystatechange=function(){4===o.readyState&&a.signal.removeEventListener("abort",u)}),o.send(void 0===a._bodyInit?null:a._bodyInit)})}w.polyfill=!0,e.fetch||(e.fetch=w,e.Headers=c,e.Request=v,e.Response=g),t.Headers=c,t.Request=v,t.Response=g,t.fetch=w}({})}(r),delete r.fetch.polyfill,(n=r.fetch).default=r.fetch,n.fetch=r.fetch,n.Headers=r.Headers,n.Request=r.Request,n.Response=r.Response,e.exports=n}),ze=(He.fetch,He.Headers),We=(He.Request,He.Response,"object"==typeof self?self.FormData:window.FormData),Je="1.7.4";function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(n,!0).forEach(function(t){b(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $e=function(){function e(t,n,r){var s=this;g(this,e),b(this,"_hasConnectionID",function(){return Boolean(s.connectionID)}),b(this,"dispatchEvent",function(e){s._handleClientEvent(e);var t=e.cid,n=s.activeChannels[t];n&&n._handleChannelEvent(e),s._callClientListeners(e),n&&n._callChannelListeners(e)}),b(this,"handleEvent",function(e){var t=e.data,n=JSON.parse(t);n.received_at=new Date,s.dispatchEvent(n)}),b(this,"_callClientListeners",function(e){var t=s,n=[];t.listeners.all&&n.push.apply(n,y(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,y(t.listeners[e.type]));for(var r=0,i=n;r<i.length;r++){(0,i[r])(e)}}),b(this,"recoverState",f(h.mark(function e(){var t,n,r,i,a,o,c;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s.logger("info","client:recoverState() - Start of recoverState with connectionID ".concat(s.wsConnection.connectionID),{tags:["connection"]}),s.connectionID=s.wsConnection.connectionID,t=Object.keys(s.activeChannels),n={},r=0,i=Object.values(s.activeChannels);r<i.length;r++)a=i[r],o=a.lastMessage(),c=void 0,o&&(c=o.id),n[a.cid]=c;if(!t.length){e.next=11;break}return s.logger("info","client:recoverState() - Start the querying of ".concat(t.length," channels"),{tags:["connection","client"]}),e.next=9,s.queryChannels({cid:{$in:t}},{last_message_at:-1},{limit:30,recovery:!0,last_message_ids:n});case 9:s.logger("info","client:recoverState() - Querying channels finished",{tags:["connection","client"]}),s.dispatchEvent({type:"connection.recovered"});case 11:case"end":return e.stop()}},e)}))),b(this,"_isUsingServerAuth",function(){return!!s.secret}),this.key=t,this.userToken=null,this.secret=null,this.listeners={},this.state=new me,this.mutedChannels=[],n&&n.indexOf&&(this.secret=n),(r=r||n)||(r={}),this.browser=void 0!==r.browser?r.browser:"undefined"!=typeof window,this.node=!this.browser;var i,a={timeout:3e3};if(this.node){var o={httpAgent:new qe.Agent({keepAlive:3e3}),httpsAgent:new Ne.Agent({keepAlive:3e3})};this.options=Ve({},o,{},a,{},r)}else this.options=Ve({},a,{},r),delete this.options.httpAgent,delete this.options.httpsAgent;this.setBaseURL("https://chat-us-east-1.stream-io-api.com"),"undefined"!=typeof process&&process.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030"),this.wsConnection=null,this.wsPromise=null,this.activeChannels={},this.configs={},this.anonymous=!1,this.logger=(i=r.logger)&&("[object Function]"===Object.prototype.toString.call(i)||"function"==typeof i||i instanceof Function)?r.logger:function(){}}return w(e,[{key:"devToken",value:function(e){return Fe(e)}},{key:"getAuthType",value:function(){return this.anonymous?"anonymous":"jwt"}},{key:"setBaseURL",value:function(e){this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws")}},{key:"_setupConnection",value:function(){return this.UUID=oe(),this.clientID="".concat(this.userID,"--").concat(this.UUID),this.wsPromise=this.connect(),this._startCleaning(),this.wsPromise}},{key:"setUser",value:function(e,t){if(this.userID)throw new Error("Use client.disconnect() before trying to connect as a different user. setUser was called twice.");if(this.userID=e.id,!this.userID)throw new Error('The "id" field on the user is missing');if(this.userToken=t,null==t&&null!=this.secret&&(this.userToken=this.createToken(this.userID)),null==this.userToken)throw new Error("both userToken and api secret are not provided");var n=Me(this.userToken);if(null!=t&&(null==n||""===n||n!==e.id))throw new Error("userToken does not have a user_id or is not matching with user.id");return this._setUser(e),this.anonymous=!1,this._setupConnection()}},{key:"_setUser",value:function(e){this.user=e,this._user=Ve({},e)}},{key:"updateAppSettings",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.apn_config&&t.apn_config.p12_cert&&(t.apn_config.p12_cert=Buffer.from(t.apn_config.p12_cert).toString("base64")),e.next=3,this.patch(this.baseURL+"/app",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAppSettings",value:function(){var e=f(h.mark(function e(){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/app");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"testPushSettings",value:function(){var e=f(h.mark(function e(t){var n,r=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/check_push",Ve({user_id:t},n.messageID?{message_id:n.messageID}:{},{},n.apnTemplate?{apn_template:n.apnTemplate}:{},{},n.firebaseTemplate?{firebase_template:n.firebaseTemplate}:{},{},n.firebaseDataTemplate?{firebase_data_template:n.firebaseDataTemplate}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){this.logger("info","client:disconnect() - Disconnecting the client",{tags:["connection","client"]}),delete this.user,delete this._user,delete this.userID,null!=this.cleaningIntervalRef&&(clearInterval(this.cleaningIntervalRef),this.cleaningIntervalRef=null),this.anonymous=!1,this.userToken=null,this.connectionEstablishedCount=0;for(var e=0,t=Object.values(this.activeChannels);e<t.length;e++){t[e]._disconnect()}return this.activeChannels={},this.state=new me,this.wsConnection?this.wsConnection.disconnect():Promise.resolve()}},{key:"setAnonymousUser",value:function(){return this.anonymous=!0,this.userID=oe(),this._setUser({id:this.userID,anon:!0}),this._setupConnection()}},{key:"setGuestUser",value:function(){var e=f(h.mark(function e(t){var n,r,s;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.anonymous=!0,e.prev=1,e.next=4,this.post(this.baseURL+"/guest",{user:t});case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.anonymous=!1,e.t0;case 11:return this.anonymous=!1,r=n.user,r.created_at,r.updated_at,r.last_active,r.online,s=u(r,["created_at","updated_at","last_active","online"]),e.next=15,this.setUser(s,n.access_token);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this,[[1,7]])}));return function(t){return e.apply(this,arguments)}}()},{key:"createToken",value:function(e,t){if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");var n={};return null!=t&&(n.exp=t),Te(this.secret,e,n,{})}},{key:"on",value:function(e,t){var n=this,r=t?e:"all";if(!fe(r))throw Error("Invalid event type ".concat(r));var s=t||e;return r in this.listeners||(this.listeners[r]=[]),this.logger("info","Attaching listener for ".concat(r," event"),{tags:["event","client"]}),this.listeners[r].push(s),{unsubscribe:function(){n.listeners[r]=n.listeners[r].filter(function(e){return e!==s})}}}},{key:"off",value:function(e,t){var n=t?e:"all";if(!fe(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this.logger("info","Removing listener for ".concat(n," event"),{tags:["event","client"]}),this.listeners[n]=this.listeners[n].filter(function(e){return e!==r})}},{key:"_logApiRequest",value:function(e,t,n,r){this.logger("info","client: ".concat(e," - Request - ").concat(t),{tags:["api","api_request","client"],url:t,payload:n,config:r})}},{key:"_logApiResponse",value:function(e,t,n){this.logger("info","client:".concat(e," - Response - url: ").concat(t," > status ").concat(n.status),{tags:["api","api_response","client"],url:t,response:n})}},{key:"_logApiError",value:function(e,t,n){this.logger("error","client:".concat(e," - Error - url: ").concat(t),{tags:["api","api_response","client"],url:t,error:n})}},{key:"get",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._logApiRequest("get",t,{},this._addClientParams(n)),e.next=4,ne.get(t,this._addClientParams(n));case 4:return r=e.sent,this._logApiResponse("get",t,r),e.abrupt("return",this.handleResponse(r));case 9:if(e.prev=9,e.t0=e.catch(0),this._logApiError("get",t,e.t0),!e.t0.response){e.next=16;break}return e.abrupt("return",this.handleResponse(e.t0.response));case 16:throw e.t0;case 17:case"end":return e.stop()}},e,this,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._logApiRequest("put",t,n,this._addClientParams()),e.next=4,ne.put(t,n,this._addClientParams());case 4:return r=e.sent,this._logApiResponse("put",t,r),e.abrupt("return",this.handleResponse(r));case 9:if(e.prev=9,e.t0=e.catch(0),this._logApiError("get",t,e.t0),!e.t0.response){e.next=16;break}return e.abrupt("return",this.handleResponse(e.t0.response));case 16:throw e.t0;case 17:case"end":return e.stop()}},e,this,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._logApiRequest("post",t,n,this._addClientParams()),e.next=4,ne.post(t,n,this._addClientParams());case 4:return r=e.sent,this._logApiResponse("post",t,r),e.abrupt("return",this.handleResponse(r));case 9:if(e.prev=9,e.t0=e.catch(0),this._logApiError("post",t,e.t0),!e.t0.response){e.next=16;break}return e.abrupt("return",this.handleResponse(e.t0.response));case 16:throw e.t0;case 17:case"end":return e.stop()}},e,this,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"patch",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._logApiRequest("patch",t,n,this._addClientParams()),e.next=4,ne.patch(t,n,this._addClientParams());case 4:return r=e.sent,this._logApiResponse("patch",t,r),e.abrupt("return",this.handleResponse(r));case 9:if(e.prev=9,e.t0=e.catch(0),this._logApiError("patch",t,e.t0),!e.t0.response){e.next=16;break}return e.abrupt("return",this.handleResponse(e.t0.response));case 16:throw e.t0;case 17:case"end":return e.stop()}},e,this,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._logApiRequest("delete",t,{},this._addClientParams()),e.next=4,ne.delete(t,this._addClientParams(n));case 4:return r=e.sent,this._logApiResponse("delete",t,r),e.abrupt("return",this.handleResponse(r));case 9:if(e.prev=9,e.t0=e.catch(0),this._logApiError("delete",t,e.t0),!e.t0.response){e.next=16;break}return e.abrupt("return",this.handleResponse(e.t0.response));case 16:throw e.t0;case 17:case"end":return e.stop()}},e,this,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendFile",value:function(){var e=f(h.mark(function e(t,n,r,s,i){var a,o,c,u;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new We,c=this._addClientParams(),null!==(h=n)&&"object"===_(h)&&"function"==typeof h._read&&"object"===_(h._readableState)||n instanceof File?o=n:(o={uri:n,name:r||n.split("/").reverse()[0]},null!=s&&(o.type=s)),null!=i&&a.append("user",JSON.stringify(i)),a.append("file",o),e.next=7,He("".concat(t,"?api_key=").concat(this.key),{method:"post",body:a,headers:new ze({Authorization:c.headers.Authorization,"stream-auth-type":this.getAuthType()})});case 7:return u=e.sent,e.next=10,u.json();case 10:return u.data=e.sent,e.abrupt("return",this.handleResponse(u));case 12:case"end":return e.stop()}var h},e,this)}));return function(t,n,r,s,i){return e.apply(this,arguments)}}()},{key:"errorFromResponse",value:function(e){var t;return t=new Error("StreamChat error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=new Error("StreamChat error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t}},{key:"handleResponse",value:function(e){var t=e.data;if("2"!==(e.status+"")[0])throw this.errorFromResponse(e);return t}},{key:"_handleClientEvent",value:function(e){var t=this;this.logger("info","client:_handleClientEvent - Received event of type { ".concat(e.type," }"),{tags:["event","client"],event:e}),"user.presence.changed"!==e.type&&"user.updated"!==e.type||(e.user.id===this.userID&&(this.user=Ve({},this.user,{},e.user),Object.keys(e.user).forEach(function(n){n in t._user&&(t._user[n]=e.user[n])})),t.state.updateUser(e.user),t._updateUserReferences(e.user)),"health.check"===e.type&&e.me&&(t.user=e.me,t.state.updateUser(e.me),t.mutedChannels=e.me.channel_mutes),"notification.message_new"===e.type&&(this.configs[e.channel.type]=e.channel.config),"notification.channel_mutes_updated"===e.type&&(this.mutedChannels=e.me.channel_mutes)}},{key:"_muteStatus",value:function(e){var t;return this.mutedChannels.forEach(function(n){if(n.channel.cid===e){var r=!0;n.expires&&(r=new Date(n.expires).getTime()>(new Date).getTime()),t={muted:r,createdAt:new Date(n.created_at),expiresAt:n.expires?new Date(n.expires):null}}}),t||{muted:!1,createdAt:null,expiresAt:null}}},{key:"_updateUserReferences",value:function(e){for(var t=this.state.userChannelReferences[e.id]||{},n=0,r=Object.keys(t);n<r.length;n++){var s=r[n],i=this.activeChannels[s];i&&i.state&&(i.state.members[e.id]&&(i.state.members=i.state.members.setIn([e.id,"user"],e)),i.state.watchers[e.id]&&(i.state.watchers=i.state.watchers.setIn([e.id,"user"],e)))}}},{key:"connect",value:function(){var e=f(h.mark(function e(){var t,n,r,s,i,a;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connecting=!0,t=this,this.failures=0,null!=t.userID){e.next=5;break}throw Error("Call setUser or setAnonymousUser before starting the connection");case 5:return n={client_id:t.client_id,user_id:t.userID,user_details:t._user,user_token:t.userToken,server_determines_connection_id:!0},r=encodeURIComponent(JSON.stringify(n)),s=this._getToken(),i=this.getAuthType(),t.wsURL="".concat(t.wsBaseURL,"/connect?json=").concat(r,"&api_key=").concat(this.key,"&authorization=").concat(s,"&stream-auth-type=").concat(i,"&x-stream-client=").concat(this._userAgent()),this.wsConnection=new _e({wsURL:t.wsURL,clientID:this.clientID,userID:this.userID,recoverCallback:this.recoverState,messageCallback:this.handleEvent,eventCallback:this.dispatchEvent,logger:this.logger}),e.next=13,this.wsConnection.connect();case 13:return a=e.sent,this.connectionID=this.wsConnection.connectionID,e.abrupt("return",a);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryUsers",value:function(){var e=f(h.mark(function e(t,n,r){var s,i,a,c,u,l,f,p;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n||(n={}),r||(r={}),s=[],i=0,a=Object.entries(n);i<a.length;i++)c=o(a[i],2),u=c[0],l=c[1],s.push({field:u,direction:l});return f={presence:!0},e.next=7,this.wsPromise;case 7:return this._hasConnectionID()||(f.presence=!1),e.next=10,this.get(this.baseURL+"/users",{payload:Ve({filter_conditions:t,sort:s},f,{},r)});case 10:return p=e.sent,this.state.updateUsers(p.users),e.abrupt("return",p);case 13:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"queryChannels",value:function(){var e=f(h.mark(function e(t){var n,r,s,i,a,c,u,l,f,p,d,v,y,g,m,w,b,_,k,x,C,R,E,U,S,O=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=O.length>1&&void 0!==O[1]?O[1]:{},r=O.length>2&&void 0!==O[2]?O[2]:{},s=[],i=0,a=Object.entries(n);i<a.length;i++)c=o(a[i],2),u=c[0],l=c[1],s.push({field:u,direction:l});return f={state:!0,watch:!0,presence:!1},e.next=7,this.wsPromise;case 7:return this._hasConnectionID()||(f.watch=!1),p=Ve({filter_conditions:t,sort:s,user_details:this._user},f,{},r),e.next=11,this.get(this.baseURL+"/channels",{payload:p});case 11:for(d=e.sent,v=[],y=!0,g=!1,m=void 0,e.prev=16,w=d.channels[Symbol.iterator]();!(y=(b=w.next()).done);y=!0)_=b.value,this._addChannelConfig(_);e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),g=!0,m=e.t0;case 24:e.prev=24,e.prev=25,y||null==w.return||w.return();case 27:if(e.prev=27,!g){e.next=30;break}throw m;case 30:return e.finish(27);case 31:return e.finish(24);case 32:for(k=!0,x=!1,C=void 0,e.prev=35,R=d.channels[Symbol.iterator]();!(k=(E=R.next()).done);k=!0)U=E.value,(S=this.channel(U.channel.type,U.channel.id)).data=U.channel,S.initialized=!0,S._initializeState(U),v.push(S);e.next=43;break;case 39:e.prev=39,e.t1=e.catch(35),x=!0,C=e.t1;case 43:e.prev=43,e.prev=44,k||null==R.return||R.return();case 46:if(e.prev=46,!x){e.next=49;break}throw C;case 49:return e.finish(46);case 50:return e.finish(43);case 51:return e.abrupt("return",v);case 52:case"end":return e.stop()}},e,this,[[16,20,24,32],[25,,27,31],[35,39,43,51],[44,,46,50]])}));return function(t){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=f(h.mark(function e(t,n){var r,s,i=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>2&&void 0!==i[2]?i[2]:{},s=Ve({filter_conditions:t},r),"string"!=typeof n){e.next=6;break}s.query=n,e.next=11;break;case 6:if("object"!==_(n)){e.next=10;break}s.message_filter_conditions=n,e.next=11;break;case 10:throw Error("Invalid type ".concat(_(n)," for query parameter"));case 11:return e.next=13,this.wsPromise;case 13:return e.next=15,this.get(this.baseURL+"/search",{payload:s});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addDevice",value:function(){var e=f(h.mark(function e(t,n){var r,s=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:null,e.next=3,this.post(this.baseURL+"/devices",Ve({id:t,push_provider:n},null!=r?{user_id:r}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDevices",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/devices",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeDevice",value:function(){var e=f(h.mark(function e(t){var n,r=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,e.next=3,this.delete(this.baseURL+"/devices",Ve({id:t},n?{user_id:n}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_addChannelConfig",value:function(e){this.configs[e.channel.type]=e.channel.config}},{key:"channel",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.userID&&!this._isUsingServerAuth())throw Error("Call setUser or setAnonymousUser before creating a channel");if(~e.indexOf(":"))throw Error("Invalid channel group ".concat(e,", can't contain the : character"));if(null==t||""===t)return new ge(this,e,void 0,n||{});if("object"===_(t)&&2===arguments.length)return new ge(this,e,void 0,t);if("string"==typeof t&&~t.indexOf(":"))throw Error("Invalid channel id ".concat(t,", can't contain the : character"));var r="".concat(e,":").concat(t);if(r in this.activeChannels){var s=this.activeChannels[r];return Object.keys(n).length>0&&(s.data=n,s._data=n),s}var i=new ge(this,e,t,n);return this.activeChannels[i.cid]=i,i}},{key:"updateUser",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upsertUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"partialUpdateUser",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.partialUpdateUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"upsertUsers",value:function(){var e=f(h.mark(function e(t){var n,r,s,i,a,o,c;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=!0,s=!1,i=void 0,e.prev=4,a=t[Symbol.iterator]();case 6:if(r=(o=a.next()).done){e.next=14;break}if((c=o.value).id){e.next=10;break}throw Error("User ID is required when updating a user");case 10:n[c.id]=c;case 11:r=!0,e.next=6;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),s=!0,i=e.t0;case 20:e.prev=20,e.prev=21,r||null==a.return||a.return();case 23:if(e.prev=23,!s){e.next=26;break}throw i;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return e.next=30,this.post(this.baseURL+"/users",{users:n});case 30:return e.abrupt("return",e.sent);case 31:case"end":return e.stop()}},e,this,[[4,16,20,28],[21,,23,27]])}));return function(t){return e.apply(this,arguments)}}()},{key:"upsertUser",value:function(e){return this.upsertUsers([e])}},{key:"updateUsers",value:function(e){return this.upsertUsers(e)}},{key:"partialUpdateUsers",value:function(){var e=f(h.mark(function e(t){var n,r,s,i,a;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,s=void 0,e.prev=3,i=t[Symbol.iterator]();case 5:if(n=(a=i.next()).done){e.next=12;break}if(a.value.id){e.next=9;break}throw Error("User ID is required when updating a user");case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,s=e.t0;case 18:e.prev=18,e.prev=19,n||null==i.return||i.return();case 21:if(e.prev=21,!r){e.next=24;break}throw s;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.next=28,this.patch(this.baseURL+"/users",{users:t});case 28:return e.abrupt("return",e.sent);case 29:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteUser",value:function(){var e=f(h.mark(function e(t,n){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/users/".concat(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"reactivateUser",value:function(){var e=f(h.mark(function e(t,n){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(t,"/reactivate"),Ve({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deactivateUser",value:function(){var e=f(h.mark(function e(t,n){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(t,"/deactivate"),Ve({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"exportUser",value:function(){var e=f(h.mark(function e(t,n){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/".concat(t,"/export"),Ve({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"banUser",value:function(){var e=f(h.mark(function e(t,n){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/ban",Ve({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"unbanUser",value:function(){var e=f(h.mark(function e(t,n){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/moderation/ban",Ve({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"muteUser",value:function(){var e=f(h.mark(function e(t){var n,r=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,e.next=3,this.post(this.baseURL+"/moderation/mute",Ve({target_id:t},n?{user_id:n}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unmuteUser",value:function(){var e=f(h.mark(function e(t){var n,r=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,e.next=3,this.post(this.baseURL+"/moderation/unmute",Ve({target_id:t},n?{user_id:n}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"flagMessage",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/flag",{target_message_id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"flagUser",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/flag",{target_user_id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unflagMessage",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/unflag",{target_message_id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unflagUser",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/unflag",{target_user_id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"markAllRead",value:function(){var e=f(h.mark(function e(){var t,n=arguments;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/channels/read",Ve({},t));case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createChannelType",value:function(e){var t=r({},{commands:["all"]},e);return this.post(this.baseURL+"/channeltypes",t)}},{key:"getChannelType",value:function(e){return this.get(this.baseURL+"/channeltypes/".concat(e))}},{key:"updateChannelType",value:function(e,t){return this.put(this.baseURL+"/channeltypes/".concat(e),t)}},{key:"deleteChannelType",value:function(e){return this.delete(this.baseURL+"/channeltypes/".concat(e))}},{key:"listChannelTypes",value:function(){return this.get(this.baseURL+"/channeltypes")}},{key:"updateMessage",value:function(){var e=f(h.mark(function e(t,n){var s;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error("Please specify the message id when calling updateMesssage");case 2:return delete(s=r({},t)).id,["latest_reactions","own_reactions","reply_count","reaction_counts","created_at","updated_at","html","command","type","user"].forEach(function(e){null!=s[e]&&delete s[e]}),null!=n&&("string"==typeof n||n instanceof String?s.user_id=n:s.user={id:n.id}),e.next=9,this.post(this.baseURL+"/messages/".concat(t.id),{message:s});case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteMessage",value:function(){var e=f(h.mark(function e(t,n){var r;return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r={hard:!0}),e.next=4,this.delete(this.baseURL+"/messages/".concat(t),r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMessage",value:function(){var e=f(h.mark(function e(t){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/messages/".concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_userAgent",value:function(){return"stream-chat-javascript-client-".concat(this.node?"node":"browser","-").concat(Je)}},{key:"_addClientParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._getToken();return Ve({},this.options,{params:Ve({user_id:this.userID},e,{api_key:this.key,connection_id:this.connectionID}),headers:{Authorization:t,"stream-auth-type":this.getAuthType(),"x-stream-client":this._userAgent()}})}},{key:"_getToken",value:function(){if(null==this.secret&&null==this.userToken&&!this.anonymous)throw new Error("Both secret and user tokens are not set. Either client.setUser wasn't called or client.disconnect was called");var e="";return this.anonymous||(e=null!=this.userToken?this.userToken:Pe(this.secret)),e}},{key:"_startCleaning",value:function(){var e=this;null==this.cleaningIntervalRef&&(this.cleaningIntervalRef=setInterval(function(){for(var t=0,n=Object.values(e.activeChannels);t<n.length;t++){n[t].clean()}},500))}},{key:"verifyWebhook",value:function(e,t){return Be(e,this.secret,t)}}]),e}(),Xe=["*"],Ye=["*"],Ke=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xe,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ye,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"Allow";g(this,e),this.name=t,this.action=a,this.owner=i,this.priority=n,this.resources=r,this.roles=s},Qe=new Ke("Allow all",999,Xe,Ye,!1,"Allow"),Ze=new Ke("Deny all",1,Xe,Ye,!1,"Deny");e.StreamChat=$e,e.logChatPromiseExecution=pe,e.ClientState=me,e.Channel=ge,e.ChannelState=he,e.StableWSConnection=_e,e.Allow="Allow",e.Deny="Deny",e.AnyResource=Xe,e.AnyRole=Ye,e.MaxPriority=999,e.MinPriority=1,e.Permission=Ke,e.AllowAll=Qe,e.DenyAll=Ze,e.EVENT_MAP=le,e.isValidEventType=fe,e.JWTUserToken=Te,e.JWTServerToken=Pe,e.UserFromToken=Me,e.DevToken=Fe,e.CheckSignature=Be,e.encodeBase64=De,e.decodeBase64=je}(this.window=this.window||{});
//# sourceMappingURL=browser.full-bundle.min.js.map
